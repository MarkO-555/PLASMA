include "inc/cmdsys.plh"
include "inc/lines.plh"
include "inc/args.plh"
include "inc/fileio.plh"
include "dhgr.tk/inc/dhgrlib.plh"
include "dhgr.tk/inc/dhgrutils.plh"

sysflags resxtxt1|reshgr1|resxhgr1

var arg
var xPen = 58
var yPen = 30
var fontWidth, fontHeight
var surf, span
char msg = "Hello, world"

arg = argNext(argFirst)
dhgrMode(DHGR_COLOR_MODE)
screenRead("scroll.dhgr")
//dcgrColor(CLR_WHITE)
//dhgrClearBl7(0, 0, SCR_WIDTH7, SCR_HEIGHT)
//dcgrColor(CLR_BLACK)
//xPen, yPen = dcgrStr(xPen, yPen, @msg)
//dcgrFont(@fontDefThin)
//xPen, yPen = dcgrStr(xPen, yPen, @msg)
while arg and ^arg
    dcgrFont(fontRead(arg))
    fontWidth, fontHeight = fontGlyphDim
    fontHeight++
    yPen = yPen + fontHeight
    if fontType & FONT_PIXMAP
        surf, span = dhgrAllocBl7Mem(fontWidth * msg, fontHeight)
        dhgrSurfMem(OP_SRC, fontHeight, surf, span)
        dcgrColor(CLR_WHITE)
        dhgrClearBl7(0, 0, span>>2, fontHeight)
        dhgrOp(OP_XOR)
        dcgrStr(0, (fontHeight * 3) / 4, @msg)
        dhgrSurfScr(OP_AND)
        dhgrMemBl7(xPen/7, yPen, span >> 2, fontHeight, surf, span)
        heaprelease(surf)
    else
        dhgrOp(OP_SRC)
        dcgrColor(CLR_BLACK)
        dcgrStr(xPen, yPen, @msg)
    fin
    arg = argNext(arg)
loop
getc
dhgrMode(DHGR_TEXT_MODE)
done
